<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>List of Internships</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .container {
      max-width: 900px;
      margin-top: 50px;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .table thead {
      background-color: #f1f1f1;
    }
    .btn {
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2 class="text-center text-success">List of Internships</h2>
  <table class="table table-striped">
    <thead>
    <tr>
      <th scope="col">Title</th>
      <th scope="col">Company</th>
      <th scope="col">Description</th>
      <th scope="col">Start Date</th>
      <th scope="col">End Date</th>
      <th scope="col">Location</th>
      <th scope="col">Actions</th>  <!-- New column for buttons -->
    </tr>
    </thead>
    <tbody id="internshipTableBody">
    <!-- Internship data will be dynamically inserted here -->
    </tbody>
  </table>
  <a href="index.html" class="btn btn-secondary w-100">Back to Dashboard</a>
</div>

<script>
  // Fetch the list of internships from the backend
  fetch('http://localhost:8080/internship/listInternships')
          .then(response => response.json())
          .then(data => {
            const tableBody = document.getElementById('internshipTableBody');
            data.forEach(internship => {
              const row = document.createElement('tr');
              row.setAttribute('data-id', internship.id); // Store the internship ID as a data attribute for easy access
              row.innerHTML = `
          <td>${internship.title}</td>
          <td>${internship.company}</td>
          <td>${internship.description}</td>
          <td>${internship.startDate}</td>
          <td>${internship.endDate}</td>
          <td>${internship.location}</td>
          <td>
            <button class="btn btn-danger btn-sm" onclick="deleteInternship(${internship.id}, this)">Delete</button>
            <a href="updateStage.html?id=${internship.id}" class="btn btn-primary btn-sm">Update</a>
          </td>
        `;
              tableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Failed toooooooooooo load internships.');
          });

  // Function to handle internship deletion
  function deleteInternship(id, button) {
    if (confirm('Are you sure you want to delete this internship?')) {
      fetch(`http://localhost:8080/internship/deleteInternship/${id}`, {
        method: 'DELETE',
      })
              .then(response => {
                if (response.ok) {
                  // Find the closest <tr> and remove it from the table
                  const row = button.closest('tr');
                  row.remove();
                  alert('Internship deleted successfully!');
                } else {
                  alert('Failed to delete internship.');
                }
              })
              .catch(error => {
                console.error('Error:', error);
                alert('Failed to delete internship.');
              });
    }
  }
</script>


</body>
</html>
